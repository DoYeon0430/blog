{% load static %}
{% load myprofile_filter %}
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="ÌäπÎ≥ÑÌïú ÏàúÍ∞ÑÎì§ÏùÑ Í∏∞ÏñµÌïòÍ≥† Í≥µÏú†ÌïòÏÑ∏Ïöî.">
    <meta name="og:url" content="https://doyeon0430.com/secret/" />
    <meta name="author" content="Doyeon0430">


    <meta property="og:title" content="Ïö∞Î¶¨Ïùò ÎîîÎç∞Ïù¥">
    <meta property="og:description" content="ÌäπÎ≥ÑÌïú ÏàúÍ∞ÑÎì§ÏùÑ Í∏∞ÏñµÌïòÍ≥† Í≥µÏú†ÌïòÏÑ∏Ïöî.">
    <meta property="og:image" content="https://cdn.pixabay.com/photo/2017/08/06/20/11/wedding-2595862_1280.jpg">

    <title>Ïö∞Î¶¨Ïùò ÎîîÎç∞Ïù¥</title>
</head>

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #333;
        text-align: center;
        padding: 20px 0;
    }

    header a {
        text-decoration: none;
        color: #fff;
    }

    h1 {
        display: inline-block;
        font-size: 24px;
        margin: 0;
    }

    h3 {
        font-size: 20px;
        padding-top: 20px;
        margin: 0;
        color: #50c32c;
    }

    section {
        background-color: #fff;
        margin: 20px;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    }

    #countdown {
        font-size: 32px;
        font-weight: bold;
        margin: 10px;
        color: #ff5733;
        text-align: center;
        animation: animate 2s infinite;
    }

    #date-list {
        list-style: none;
        padding: 0;
    }

    #date-list a {
        color: #000000;
        text-decoration: none;
    }

    #date-list a li {
        font-size: 18px;
        color: #000000;
        margin-bottom: 13px;
        cursor: pointer;
    }

    div {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
    }

    label {
        font-weight: bold;
        min-width: 50px;
        /* Í≥†Ï†ïÎêú ÎùºÎ≤® ÎÑàÎπÑÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§. */
    }

    input[type="text"],
    input[type="date"],
    .password {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        overflow-x: auto;
        max-width: 100%;
    }

    textarea {
        flex: 1;
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        height: 100px;
        resize: none;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        overflow-x: auto;
        max-width: 100%;
        font-family: Arial, sans-serif;
    }

    img {
        max-width: 100%;
        border-radius: 8px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    }

    .section_main {
        max-width: 600px;
        margin: 10px auto;
        display: block;
    }

    .styled-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .styled-table th,
    .styled-table td {
        padding: 8px;
        text-align: left;
    }

    .styled-table th {
        background-color: #000000;
        color: #ffffff;
        font-size: 16px;
    }

    .styled-table td:nth-child(2),
    .styled-table th {
        text-align: center;
    }

    .styled-table tr:nth-child(even) {
        background-color: #e8e8e8;
    }

    .styled-table tr:last-child td {
        font-weight: bold;
        text-align: center;
        border-top: 2px double #000;
        border-bottom: 2px double #000;
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination a {
        font-weight: bold;
        color: #000000;
        padding: 4px 8px;
        text-decoration: none;
        border: 1px solid #ffffff;
        border-radius: 4px;
        margin: 0 4px;
        transition: background-color 0.3s, color 0.3s;
    }

    .pagination a:hover {
        text-decoration: underline;
    }

    .pagination .current {
        font-weight: bold;
        color: #d31900;
        padding: 4px 8px;
        text-decoration: underline;
        border: 1px solid #ffffff;
        border-radius: 4px;
        margin: 0 4px;
        transition: background-color 0.3s, color 0.3s;
    }

    .button_design {
        background-color: #000000;
        font-weight: bold;
        color: #fff;
        padding: 10px 45px;
        border-radius: 5px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
    }

    .create-post-link {
        color: black;
        border-bottom: 2px solid black;
        text-decoration: none;
        font-weight: bold;
    }

    .messages {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .messages li {
        position: relative;
        margin: 0;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        padding-right: 20px;
    }

    .messages li {
        display: flex;
        align-items: center;
        position: relative;
        padding-right: 20px;
        /* Space for the close button */
    }

    .close {
        font-size: 20px;
        margin-left: auto;
        /* Push the close button to the right */
        cursor: pointer;
    }

    .success {
        background-color: #d4edda;
        color: #155724;
    }

    .error {
        background-color: #f8d7da;
        color: #721c24;
    }

    #date-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }

    #date-list a li {
        padding: 10px 0;
        margin-bottom: 0px;
    }

    .post-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ccc;
        padding: 5px 0;
    }

    .post-text {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        overflow: hidden;
        flex: 1;
        margin-bottom: 0px;
    }

    .post-number {
        font-weight: bold;
        font-size: 14px;
        color: green;
        text-align: left;
        margin-bottom: 0px;
        padding: 5px 0;
    }

    .post-content {
        font-size: 16px;
        font-weight: bold;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: left;
        margin-bottom: 0px;
        padding: 5px 0;
    }
    
    .post-details {
        color: #4a506b;
        font-size: 14px;
        text-align: left;
        margin-bottom: 0px;
        padding: 5px 0;
    }

    .post-image {
        margin-bottom: 0px;
    }
    .post-image img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        margin-left: 8px;
        border-radius: 8px;
        box-shadow: 0 0 0;
        justify-content: center;
    }

</style>

<body>
    <header>
        <a href="{% url 'myprofile:secret' %}">
            <h1>Ïö∞Î¶¨Ïùò ÎîîÎç∞Ïù¥</h1>
        </a>
    </header>
    <div class="section_main">
        <section class="countdown">
            <h2>üïû ÎîîÎç∞Ïù¥ Í∏∞Ï§Ä</h2>
            <p id="countdown"></p>
        </section>
    </div>

    <div class="section_main">
        <section class="dates">
            <h2>üìÜ Îç∞Ïù¥Ìä∏ ÎÇ†Ïßú Ï†ïÎ¶¨</h2>
            <ul id="date-list">
                {% for date in meeting_dates %}
                <a href="{% url 'myprofile:secret_view' date.id %}">
                    <li>
                        {{ date.date|date:"YÎÖÑ mÏõî dÏùº" }}
                        {% if date.photo %}
                        <svg style="color: rgb(49, 155, 17);" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                            fill="currentColor" class="bi bi-images" viewBox="0 0 16 16">
                            <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" />
                            <path
                                d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2M14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1M2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1z" />
                        </svg>
                        {% endif %}
                    </li>
                </a>
                {% endfor %}
            </ul>
            <div class="pagination">
                <span class="step-links">
                    {% if page_range|last > 2 and meeting_dates.number == page_range|last %}
                    <a href="?meeting_page={{ page_range|last|sub:2 }}">{{ page_range|last|sub:2 }}</a>
                    {% endif %}

                    {% if meeting_dates.number > 1 %}
                        {% for i in page_range %}
                            {% if i >= meeting_dates.number|sub:1 and i < meeting_dates.number|add:2 %}
                                {% if meeting_dates.number == i %}
                                    <span class="current">{{ i }}</span>
                                {% else %}
                                    <a href="?meeting_page={{ i }}">{{ i }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% for i in page_range %}
                            {% if i <= 2 %}
                                {% if meeting_dates.number == i %}
                                    <span class="current">{{ i }}</span>
                                {% else %}
                                    <a href="?meeting_page={{ i }}">{{ i }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    
                    {% if page_range|last > 2 and meeting_dates.number == 1 %}
                        <a href="?meeting_page={{ 3 }}">{{ 3 }}</a>
                    {% endif %}
                </span>                  
            </div>
        </section>
    </div>

    <div class="section_main">
        <section>
            <h2>üìÜ Îç∞Ïù¥Ìä∏ ÎÇ†Ïßú ÏóÖÎ°úÎìú</h2>
            <form method="post" enctype="multipart/form-data" id="imageUploadForm">
                {% csrf_token %}
                <div>
                    <label for="id_photo" style="cursor:pointer">
                        <img src="{% if meeting_date.photo %}{{ meeting_date.photo.url }}{% else %}{% static 'img/noimage.jpeg' %}{% endif %}"alt="Ïù¥ÎØ∏ÏßÄ" id="imagePreview">
                    </label>
                    <input type="file" name="photo" id="id_photo" accept="image/*" style="display: none;" onchange="previewImage(this);">
                </div>
                <p style="text-align: right; color: #cd2121; font-size: 12px; font-weight: bold;">Î≥ÑÌëú(*)Îäî ÌïÑÏàòÎ°ú ÏûÖÎ†•</p>
                <div>
                    <label for="id_date">ÎÇ†Ïßú <span style="color: #cd2121;">*</span></label>
                    {{ form.date }}
                </div>                
                <div>
                    <label for="id_text">ÏßÄÏó≠ <span style="color: #cd2121;">*</span></label>
                    {{ form.text }}
                </div>
                <div>
                    <label for="id_details">Ïû•ÏÜå <span style="color: #cd2121;">*</span></label>
                    {{ form.details }}
                </div>                
                <div>
                    <label for="id_details">ÌõÑÍ∏∞</label>
                    {{ form.description }}
                </div>
                <div>
                    <label for="id_password">ÏïîÌò∏ <span style="color: #cd2121;">*</span></label>
                    <input type="password" name="password" id="id_password" class="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                        maxlength="6" oninput="validateInput(this)">
                </div>
                {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>
                        {{ message }}
                        <span class="close" onclick="this.parentElement.style.display='none';">&times;</span>
                        </li>
                        {% endfor %}
                </ul>
                {% endif %}
                <div style="display: block; text-align: right; margin: 20px 0 0 0;">
                    <button type="submit" class="button_design">
                        Ï∂îÍ∞Ä
                    </button>
                </div>
            </form>
        </section>
    </div>

    <div class="section_main">
        <section>
            <h2>üìä Îç∞Ïù¥Ìä∏ ÏßÄÏó≠ ÌÜµÍ≥Ñ</h2>

            <table class="styled-table">
                <tr>
                    <th>Îç∞Ïù¥Ìä∏ ÏßÄÏó≠</th>
                    <th>ÌöüÏàò</th>
                </tr>
                {% for sentence, count in character_counts %}
                <tr>
                    <td>{{ sentence }}</td>
                    <td>{{ count }}Î≤à</td>
                </tr>
                {% endfor %}
                <tr>
                    <td>Ï¥ù Í∞úÏàò</td>
                    <td>{{ total_count }}Î≤à</td>
                </tr>
            </table>
        </section>
    </div>

    <div class="section_main">
        <section>
            <h2>üìã ÎîîÎç∞Ïù¥ Í≤åÏãúÌåê</h2>
            <ul id="date-list">
                {% for post in posts %}
                <a href="{% url 'myprofile:post_detail' post.pk %}">
                    <li class="post-item">
                        <div class="post-text">
                            <div class="post-number">{{ posts.paginator.count|sub:posts.start_index|sub:forloop.counter0|add:1 }}Î≤àÏß∏ Í∏Ä</div>
                            <div class="post-content">
                                {{ post.subject }}
                            </div>
                            <div class="post-details">
                                <img src="https://everytime.kr/images/new/container.articles.comment.png" alt="Ïù¥ÎØ∏ÏßÄ" style="margin-right: 3px; width: 13px; height: 13px;box-shadow: 0 0 0;border-radius: 0;">
                                <p style="color: #05bcbc; margin: 1.5px 3px 0 0;">{{ post.chats.count }}</p> ¬∑ {{ post.create_date|date:"Y.m.d" }} ¬∑ {{ post.username }}
                            </div>
                        </div>
                        {% if post.images.all %}
                        <div class="post-image">
                            <img src="{{ post.images.first.image.url }}" alt="Post image">
                        </div>
                        {% endif %}
                    </li>
                </a>
                {% endfor %}
            </ul>
            
            <div class="pagination">
                <span class="step-links">
                    {% if post_page_range|last > 2 and posts.number == post_page_range|last %}
                    <a href="?post_page={{ post_page_range|last|sub:2 }}">{{ post_page_range|last|sub:2 }}</a>
                    {% endif %}

                    {% if posts.number > 1 %}
                        {% for i in post_page_range %}
                            {% if i >= posts.number|sub:1 and i < posts.number|add:2 %}
                                {% if posts.number == i %}
                                    <span class="current">{{ i }}</span>
                                {% else %}
                                    <a href="?post_page={{ i }}">{{ i }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% for i in post_page_range %}
                            {% if i <= 2 %}
                                {% if posts.number == i %}
                                    <span class="current">{{ i }}</span>
                                {% else %}
                                    <a href="?post_page={{ i }}">{{ i }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    
                    {% if post_page_range|last > 2 and posts.number == 1 %}
                        <a href="?post_page={{ 3 }}">{{ 3 }}</a>
                    {% endif %}
                </span>                  
            </div>
            <div style="justify-content: flex-end">
                <a href="{% url 'myprofile:create_post' %}" class="create-post-link">Í≤åÏãúÎ¨º ÏûëÏÑ±</a>
            </div>
        </section>
    </div>

    <script>
        // 1. ÎîîÎç∞Ïù¥ Í∏∞Ï§Ä //
        const dDay = new Date('2023-08-20T00:00:00');
        const today = new Date();
        today.setHours(0, 0, 0, 0); //ÏãúÍ∞Ñ Î¨¥ÏãúÌïòÍ∏∞
        const timeDifference = today - dDay;
        const oneDay = 24 * 60 * 60 * 1000;
        const daysPassed = Math.floor(timeDifference / oneDay) + 1; //ÎßåÎÇú ÎÇ† Í∏∞Ï§ÄÏúºÎ°ú 1Ïùº
        countdown.textContent = `${daysPassed}Ïùº`;

        function validateInput(input) {
            if (input.value.length > 6) {
                input.value = input.value.slice(0, 6);
            }
        }
        function previewImage(input) {
            var preview = document.getElementById('imagePreview');
            var file = input.files[0];

            if (file) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                };

                reader.readAsDataURL(file);
            }
        }
    </script>
</body>

</html>